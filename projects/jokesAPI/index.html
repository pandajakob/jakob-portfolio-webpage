<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jokes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Averia+Gruesa+Libre&display=swap" rel="stylesheet">
    

</head>
<body style="text-align: left; margin: 20%;font-family: 'Averia Gruesa Libre', system-ui; font-size: 3rem; cursor: pointer;">
    <p id="joke"> ... tap for a joke</p>
    <p style="text-align: right; font-size: 1rem;"> - jokeapi.dev </p>
</body>
<script>
    let jokeRunning = false;

    const jokeElement = document.getElementById('joke');
    const jokeURL = 'https://v2.jokeapi.dev/joke/Any?blacklistFlags=nsfw,religious,political,racist,sexist,explicit';

    document.addEventListener('click', fetchJoke)
    document.addEventListener('keydown', fetchJoke)

    async function fetchJoke() {
        if (!jokeRunning) {
        let i = 0;
        jokeRunning = true;
        console.log(i, 'iii')
        const response = await fetch(jokeURL);
            if (response.ok) {
                const jsonResponse = await response.json();        
                let joke = ''
                let jokeString = ''

                if (jsonResponse.joke) {
                    joke = jsonResponse.joke
                    
                } else {
                    joke = jsonResponse.setup + '<br>' + '...' + '<br>' + jsonResponse.delivery;
                }

                setInterval(() => {
                    if (joke != jokeString) {
                        jokeString += joke[i];
                        jokeElement.innerHTML = jokeString;
                        i++;
                    }
                }, 5)

                fetchYodaAnswer(joke);

            }
            jokeRunning = false
        }
    } 

    async function fetchYodaAnswer(joke) {
        const urlToFetch= "" + joke;
            
        const response = await fetch(urlToFetch);
        if (response.ok) {
            const jsonResponse = await response.json();
            console.log(jsonResponse, 'js')
        }

    }
</script>
</html>
